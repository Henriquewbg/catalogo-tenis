<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="manifest" href="manifest.json">
<title>Minha Coleção</title>

<style>
body {
    font-family: -apple-system, BlinkMacSystemFont, Arial, sans-serif;
    background: #f5f5f5;
    margin: 0;
}

/* HEADER */
.header {
    padding: 20px;
}

/* TABS */
.tabs {
    display: flex;
    gap: 10px;
    margin-bottom: 15px;
}

.tab {
    flex: 1;
    padding: 12px;
    text-align: center;
    background: #e5e7eb;
    border-radius: 10px;
    font-weight: 600;
}

.tab.active {
    background: #0f172a;
    color: white;
}

/* BOTÃO ESCOLHER USO */
.btn-uso-topo {
    width: 100%;
    padding: 14px;
    background: #0f172a;
    color: white;
    border: none;
    border-radius: 10px;
    font-size: 16px;
    margin-bottom: 10px;
}

/* EM USO */
.em-uso {
    background: #0f172a;
    color: white;
    padding: 15px;
    border-radius: 12px;
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    gap: 12px;
}

.em-uso img {
    width: 70px;
    border-radius: 8px;
}

.em-uso span {
    font-size: 13px;
    opacity: 0.8;
}

.em-uso .acoes {
    margin-left: auto;
}

.btn-remover-uso {
    background: #e11d48;
    color: white;
    border: none;
    padding: 6px 10px;
    border-radius: 6px;
    font-size: 12px;
}

/* BUSCA */
.search-container input {
    width: 100%;
    padding: 14px;
    font-size: 16px;
    border-radius: 8px;
    border: 1px solid #ddd;
}

.counter {
    margin-top: 6px;
    font-size: 14px;
    color: #666;
}

/* LISTA */
.secao {
    background: white;
    margin-bottom: 10px;
}

.secao-titulo {
    padding: 15px 20px;
    font-size: 13px;
    letter-spacing: 3px;
    color: #888;
    border-bottom: 1px solid #eee;
}

.item {
    display: flex;
    align-items: center;
    padding: 15px 20px;
    border-bottom: 1px solid #eee;
}

.item img {
    width: 100px;
    margin-right: 15px;
    border-radius: 8px;
}

.nome {
    font-size: 18px;
    font-weight: 600;
}

.info-extra {
    font-size: 13px;
    color: #666;
}

.tag {
    background: #eee;
    font-size: 12px;
    padding: 4px 6px;
    border-radius: 3px;
    margin-top: 6px;
    display: inline-block;
}

/* RANKING */
.rank {
    background: white;
    padding: 15px;
    border-bottom: 1px solid #eee;
    display: flex;
    align-items: center;
}

.rank img {
    width: 80px;
    margin-right: 15px;
    border-radius: 8px;
}

.rank strong {
    font-size: 18px;
}

/* CALENDÁRIO */
.calendar-day {
    background: white;
    padding: 15px;
    margin-bottom: 10px;
}

.calendar-item {
    display: flex;
    align-items: center;
    margin-bottom: 8px;
}

.calendar-item img {
    width: 60px;
    height: 60px;
    border-radius: 8px;
    margin-right: 10px;
    object-fit: cover;
    flex-shrink: 0;
}

/* BOTÃO + */
#btnAdd {
    position: fixed;
    bottom: 20px;
    right: 20px;
    width: 64px;
    height: 64px;
    border-radius: 50%;
    font-size: 28px;
    background: #0f172a;
    color: white;
    border: none;
}

/* OVERLAYS */
.overlay {
    position: fixed;
    inset: 0;
    background: white;
    display: none;
    z-index: 1000;
    padding: 20px;
    overflow-y: auto;
}

.overlay input,
.overlay select {
    width: 100%;
    padding: 14px;
    font-size: 16px;
    margin-bottom: 15px;
}

.overlay button {
    width: 100%;
    padding: 16px;
    margin-bottom: 10px;
    border: none;
    font-size: 16px;
}

.btn-salvar { background: #0f172a; color: white; }
.btn-cancelar { background: #ccc; }
.btn-excluir { background: #e11d48; color: white; }

/* LISTA ESCOLHER USO */
.item-uso {
    display: flex;
    align-items: center;
    padding: 12px;
    border-bottom: 1px solid #eee;
}

.item-uso img {
    width: 70px;
    margin-right: 12px;
    border-radius: 8px;
}

.preview {
    width: 100%;
    max-height: 220px;
    object-fit: contain;
    margin-bottom: 15px;
}

.ordenar span {
    cursor: pointer;
    font-size: 16px;
    margin-left: 6px;
    color: #999;
}

.ordenar span:hover {
    color: #0f172a;
}

</style>
</head>

<body>

<div class="header">
    <h1>Minha Coleção</h1>

    <div class="tabs">
        <div class="tab active" onclick="trocarAba('catalogo')">Catálogo</div>
        <div class="tab" onclick="trocarAba('ranking')">Ranking</div>
        <div class="tab" onclick="trocarAba('calendario')">Calendário</div>
    </div>

    <div id="areaCatalogo">
        <button class="btn-uso-topo" onclick="abrirEscolhaUso()">Escolher tênis em uso</button>
        <div id="emUsoBox"></div>

        <div class="search-container">
            <input id="searchInput" placeholder="Buscar..." oninput="renderCatalogo()">
            <div class="counter" id="counter"></div>
        </div>
    </div>
</div>

<div id="catalogo"></div>
<div id="ranking" style="display:none"></div>
<div id="calendario" style="display:none"></div>


<button id="btnAdd" onclick="novoTenis()">＋</button>

<!-- OVERLAY CADASTRO -->
<div class="overlay" id="overlay">
    <h2 id="tituloForm">Novo Tênis</h2>
    <input type="hidden" id="editId">
    <input id="modeloInput" placeholder="Modelo">
    <input id="nomeInput" placeholder="Nome">

    <select id="usadoInput">
        <option value="false">NEW</option>
        <option value="true">WORN</option>
    </select>

    <input type="file" accept="image/*" id="fotoInput">
    <img id="preview" class="preview" style="display:none">

    <button class="btn-salvar" onclick="salvarTenis()">Salvar</button>
    <button class="btn-cancelar" onclick="fechar()">Cancelar</button>
    <button class="btn-excluir" id="btnExcluir" onclick="excluirTenis()">Excluir</button>
</div>

<!-- OVERLAY ESCOLHER USO -->
<div class="overlay" id="overlayUso">
    <h2>Qual tênis você está usando?</h2>
    <div id="listaUso"></div>
    <button class="btn-cancelar" onclick="fecharEscolhaUso()">Cancelar</button>
</div>

<script>
let tenis = JSON.parse(localStorage.getItem("tenis")) || [];
let usoPorDia = JSON.parse(localStorage.getItem("usoPorDia")) || {};
let ordemModelos = JSON.parse(localStorage.getItem("ordemModelos")) || [];
let imagemBase64 = "";
let abaAtual = "catalogo";

fotoInput.addEventListener("change", e => {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = () => {
        imagemBase64 = reader.result;
        preview.src = imagemBase64;
        preview.style.display = "block";
    };
    reader.readAsDataURL(file);
});

function garantirOrdemModelos(grupos) {
    Object.keys(grupos).forEach(modelo => {
        if (!ordemModelos.includes(modelo)) {
            ordemModelos.push(modelo);
        }
    });

    ordemModelos = ordemModelos.filter(m => grupos[m]);
    salvarLocal();
}

function moverModelo(modelo, direcao) {
    const i = ordemModelos.indexOf(modelo);
    if (i < 0) return;

    const novoIndex = direcao === "up" ? i - 1 : i + 1;
    if (novoIndex < 0 || novoIndex >= ordemModelos.length) return;

    [ordemModelos[i], ordemModelos[novoIndex]] =
    [ordemModelos[novoIndex], ordemModelos[i]];

    salvarLocal();
    renderCatalogo();
}

function salvarLocal() {
    localStorage.setItem("tenis", JSON.stringify(tenis));
    localStorage.setItem("usoPorDia", JSON.stringify(usoPorDia));
    localStorage.setItem("ordemModelos", JSON.stringify(ordemModelos));
}

/* ===== TABS ===== */
function trocarAba(aba) {
    abaAtual = aba;

    document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
    document.querySelector(`.tab[onclick*="${aba}"]`).classList.add("active");

    // CONTROLE DE VISIBILIDADE
    catalogo.style.display   = aba === "catalogo"   ? "block" : "none";
    ranking.style.display    = aba === "ranking"    ? "block" : "none";
    calendario.style.display = aba === "calendario" ? "block" : "none";
    areaCatalogo.style.display = aba === "catalogo" ? "block" : "none";

    // RENDER
    if (aba === "catalogo")   renderCatalogo();
    if (aba === "ranking")    renderRanking();
    if (aba === "calendario") renderCalendario();
}

/* ===== USO ===== */
function abrirEscolhaUso() {
    listaUso.innerHTML = "";
    tenis.forEach(t => {
        const div = document.createElement("div");
        div.className = "item-uso";
        div.onclick = () => escolherEmUso(t.id);
        div.innerHTML = `
            <img src="${t.foto}">
            <div>
                <strong>${t.nome}</strong><br>
                <small>${t.modelo}</small>
            </div>
        `;
        listaUso.appendChild(div);
    });
    overlayUso.style.display = "block";
}

function fecharEscolhaUso() {
    overlayUso.style.display = "none";
}

function escolherEmUso(id) {
    const agora = Date.now();
    tenis.forEach(t => t.emUso = false);
    const t = tenis.find(x => x.id === id);
    if (t) {
        t.emUso = true;
        t.ultimoUso = agora;
        t.contadorUso = (t.contadorUso || 0) + 1;
    const hoje = new Date().toISOString().split("T")[0];
        if (!usoPorDia[hoje]) usoPorDia[hoje] = [];
        if (!usoPorDia[hoje].includes(id)) usoPorDia[hoje].push(id);

    }
    salvarLocal();
    fecharEscolhaUso();
    renderCatalogo();
}

function removerEmUso() {
    tenis.forEach(t => t.emUso = false);
    salvarLocal();
    renderCatalogo();
}

/* ===== RENDER ===== */
function diasSemUso(t) {
    if (!t.ultimoUso) return "0 dias";
    const diff = Date.now() - t.ultimoUso;
    const dias = Math.floor(diff / 86400000);
    return dias === 0 ? "0 dias" : `${dias} dia${dias > 1 ? "s" : ""} `;
}

function renderEmUso() {
    const t = tenis.find(x => x.emUso);
    if (!t) {
        emUsoBox.innerHTML = "";
        return;
    }

    emUsoBox.innerHTML = `
        <div class="em-uso">
            <img src="${t.foto}">
            <div>
                <span>EM USO AGORA</span><br>
                <strong>${t.nome}</strong>
            </div>
            <div class="acoes">
                <button class="btn-remover-uso" onclick="removerEmUso()">Remover</button>
            </div>
        </div>
    `;
}

function renderCatalogo() {
    renderEmUso();
    const busca = searchInput.value.toLowerCase();
    catalogo.innerHTML = "";
    let total = 0;
    const grupos = {};

    tenis.forEach(t => {
        if (!`${t.modelo} ${t.nome}`.toLowerCase().includes(busca)) return;
        if (!grupos[t.modelo]) grupos[t.modelo] = [];
        grupos[t.modelo].push(t);
        total++;
    });

    counter.innerText = total === 1 ? "1 item catalogado" : `${total} itens catalogados`;

    garantirOrdemModelos(grupos);

    ordemModelos.forEach(modelo => {
        const lista = grupos[modelo];
        if (!lista) return;

        const secao = document.createElement("div");
        secao.className = "secao";
        secao.innerHTML = `
        <div class="secao-titulo">
            ${modelo.toUpperCase()}
            <span style="float:right;">
                <span class="ordenar">
                    <span onclick="moverModelo('${modelo}','up')">˄</span>
                    <span onclick="moverModelo('${modelo}','down')">˅</span>
                </span>
            </span>
        </div>`;

        lista.forEach(t => {
            const item = document.createElement("div");
            item.className = "item";
            item.onclick = () => editarTenis(t.id);
            item.innerHTML = `
                <img src="${t.foto}">
                <div>
                    <div class="nome">${t.nome}</div>
                    <div class="info-extra">${diasSemUso(t)}</div>
                    <span class="tag">${t.usado ? "WORN" : "NEW"}</span>
                </div>
            `;
            secao.appendChild(item);
        });

        catalogo.appendChild(secao);
    }
)}

function renderRanking() {
    ranking.innerHTML = "";
    const ordenado = [...tenis].sort((a,b) => (b.contadorUso||0) - (a.contadorUso||0));

    ordenado.forEach((t, i) => {
        const div = document.createElement("div");
        div.className = "rank";
        div.innerHTML = `
            <img src="${t.foto}">
            <div>
                <strong>#${i+1} ${t.nome}</strong><br>
                <small>${t.contadorUso || 0} usos</small>
            </div>
        `;
        ranking.appendChild(div);
    });
}

function renderCalendario() {
    calendario.innerHTML = "";

    const dias = Object.keys(usoPorDia).sort().reverse();

    dias.forEach(dia => {
        const bloco = document.createElement("div");
        bloco.className = "calendar-day";
        bloco.innerHTML = `<h3>${dia}</h3>`;

        usoPorDia[dia].forEach(id => {
            const t = tenis.find(x => x.id === id);
            if (!t) return;

            const item = document.createElement("div");
            item.className = "calendar-item";
            item.innerHTML = `
                <img src="${t.foto}">
                <span>${t.nome}</span>
            `;
            bloco.appendChild(item);
        });

        calendario.appendChild(bloco);
    });
}

/* ===== CRUD ===== */
function novoTenis() {
    tituloForm.innerText = "Novo Tênis";
    editId.value = "";
    modeloInput.value = nomeInput.value = "";
    usadoInput.value = "false";
    imagemBase64 = "";
    preview.style.display = "none";
    btnExcluir.style.display = "none";
    overlay.style.display = "block";
}

function editarTenis(id) {
    const t = tenis.find(x => x.id === id);
    tituloForm.innerText = "Editar Tênis";
    editId.value = t.id;
    modeloInput.value = t.modelo;
    nomeInput.value = t.nome;
    usadoInput.value = t.usado;
    imagemBase64 = t.foto;
    preview.src = imagemBase64;
    preview.style.display = "block";
    btnExcluir.style.display = "block";
    overlay.style.display = "block";
}

function salvarTenis() {
    if (!imagemBase64) return alert("Selecione uma imagem");

    if (editId.value) {
        Object.assign(tenis.find(t => t.id == editId.value), {
            modelo: modeloInput.value,
            nome: nomeInput.value,
            foto: imagemBase64,
            usado: usadoInput.value === "true"
        });
    } else {
        tenis.push({
            id: Date.now(),
            modelo: modeloInput.value,
            nome: nomeInput.value,
            foto: imagemBase64,
            usado: usadoInput.value === "true",
            emUso: false,
            ultimoUso: null,
            contadorUso: 0
        });
    }

    salvarLocal();
    fechar();
    renderCatalogo();
}

function excluirTenis() {
    tenis = tenis.filter(t => t.id != editId.value);
    salvarLocal();
    fechar();
    renderCatalogo();
}

function fechar() {
    overlay.style.display = "none";
}

renderCatalogo();

if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("sw.js");
}
</script>
</body>
</html>